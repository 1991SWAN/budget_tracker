# 트랜잭션 전체 삭제 시 역산 로직 (Smart Reset Logic) 보고서

사용자 요청에 따라, **[Reset Data] -> [Transactions]**를 선택하여 거래 내역을 모두 지울 때 자산 잔액이 어떻게 복구되는지(역산 로직)에 대해 상세히 설명해 드립니다.

## 1. 핵심 원리 (Core Concept)
단순히 거래 내역만 지우면, 이미 변동된 자산 잔액(예: 지출로 줄어든 잔액)은 그대로 남게 되어 실제 잔고와 맞지 않게 됩니다.
따라서 시스템은 **"거래가 없었던 상태"**인 **최초 잔액(Initial Balance)**으로 되돌리기 위해 **역산(Reverse Calculation)**을 수행합니다.

## 2. 역산 알고리즘 3단계
코드는 `Services/SupabaseService.ts`의 `resetData` 함수에서 다음 순서로 동작합니다.

### 1단계: 영향력 합산 (Calculate Impact)
삭제될 모든 거래 내역을 스캔하여, 각 자산별로 **"얼마나 변동되었는지"** 합계를 구합니다.

- **수입 (Income)**: 자산에 +10,000원을 했다면, 영향력은 `+10,000`입니다.
- **지출 (Expense)**: 자산에서 -5,000원을 썼다면, 영향력은 `-5,000`입니다.
- **이체 (Transfer)**:
    - 보낸 곳(Source): `-10,000`
    - 받은 곳(Dest): `+10,000`

> **예시**: A통장에서 수입 +100만, 지출 -30만, 이체 -20만이 있었다면?
> -> **총 변동분(Net Change) = +50만원**

### 2단계: 되돌리기 (Revert Balance)
현재 자산 잔액에서 위에서 구한 변동분을 **반대로 뺍니다.**

$$ \text{복구될 잔액} = \text{현재 잔액} - \text{총 변동분} $$

> **예시 계속**:
> - 현재 A통장 잔액: 150만원
> - 총 변동분: +50만원
> - **복구될 잔액**: $150만 - (+50만) = 100만원$ (이것이 바로 최초 잔액)

만약 지출만 -30만원 있었다면? (`변동분 = -30만`)
- 현재 잔액: 70만원
- **복구될 잔액**: $70만 - (-30만) = 100만원$ (빼기의 빼기는 더하기가 되어 복구됨)

### 3단계: 삭제 수행 (Delete Records)
자산 잔액을 안전하게 복구한 후, 비로소 `transactions` 테이블의 모든 데이터를 삭제합니다.

## 3. 요약 (Summary)
이 로직 덕분에 사용자가 거래 내역을 모두 지우더라도, **자산을 처음 생성했을 때 입력했던 '초기 잔액' 상태로 정확하게 돌아갑니다.** 자산 자체를 지우지 않는 한, 통장의 기초 잔고는 안전하게 보존됩니다.
