# ë§í¬ ê±°ë˜ ë‚´ì—­ ë°ì´í„° ë ˆì´ì•„ì›ƒ ë³´ê³ ì„œ (Data Layout Logic)

ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ì´ì²´ ì—°ê²° ì‹œ **ë°ì´í„°ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì–´ë–»ê²Œ êµ¬ì„±ë˜ê³  ì €ì¥ë˜ëŠ”ì§€(Data Layout)**ë¥¼ ìƒì„¸íˆ ì„¤ëª…í•´ ë“œë¦½ë‹ˆë‹¤.

## 1. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (Database Schema)
Supabaseì˜ `transactions` í…Œì´ë¸”ì—ì„œ ì´ì²´ ì—°ê²°ì„ ìœ„í•´ ë‹¤ìŒ í•µì‹¬ ì»¬ëŸ¼ë“¤ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

| ì»¬ëŸ¼ëª… (Column) | íƒ€ì… (Type) | ì—­í•  (Role) | ë¹„ê³  |
| :--- | :--- | :--- | :--- |
| **`id`** | UUID | ê±°ë˜ ê³ ìœ  ì‹ë³„ì | |
| **`type`** | Text | ê±°ë˜ ìœ í˜• | 'transfer'ë¡œ ì„¤ì •ë¨ |
| **`amount`** | Numeric | ê±°ë˜ ê¸ˆì•¡ | í•­ìƒ **ì–‘ìˆ˜(+)**ë¡œ ì €ì¥ë¨ |
| **`asset_id`** | UUID | ë³¸ì¸ ê³„ì¢Œ ì‹ë³„ì | í˜„ì¬ ì¹´ë“œì˜ ì£¼ì¸ (ë‚´ ê³„ì¢Œ) |
| **`linked_transaction_id`** | UUID | ìƒëŒ€ë°© ê±°ë˜ ID | ë§ì€í¸(Pair) ê±°ë˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì™¸ë˜í‚¤ |
| **`to_asset_id`** | UUID | **ìƒëŒ€ë°© ê³„ì¢Œ ID** | **ì¶œê¸ˆ(Source) ì¸¡ì—ë§Œ ê°’ì´ ì¡´ì¬í•¨ (í•µì‹¬)** |

## 2. ì—°ê²° êµ¬ì¡° (Linking Structure)
ì´ì²´ëŠ” ë‘ ê°œì˜ ë…ë¦½ì ì¸ ê±°ë˜(Transaction Row)ê°€ ì„œë¡œë¥¼ ê°€ë¦¬í‚¤ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

### ğŸ…°ï¸ Row 1: ì¶œê¸ˆ ì¸¡ (Source / Withdrawal)
*   **`type`**: 'transfer'
*   **`asset_id`**: Bank A (ë³´ë‚´ëŠ” ê³„ì¢Œ)
*   **`to_asset_id`**: **Bank B (ë°›ëŠ” ê³„ì¢Œ ID)**  â¬…ï¸ **ë°ì´í„° ë ˆì´ì•„ì›ƒì˜ í•µì‹¬ í‚¤**
*   **`linked_transaction_id`**: Row 2ì˜ ID
*   **`amount`**: 10,000 (ì–‘ìˆ˜)
*   **UI í‘œí˜„**: `to_asset_id`ê°€ ì¡´ì¬í•˜ë¯€ë¡œ **"Dual Line UI" (ì¶œê¸ˆ/ì…ê¸ˆ ë™ì‹œ í‘œì‹œ)**ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.

### ğŸ…±ï¸ Row 2: ì…ê¸ˆ ì¸¡ (Destination / Deposit)
*   **`type`**: 'transfer'
*   **`asset_id`**: Bank B (ë°›ëŠ” ê³„ì¢Œ)
*   **`to_asset_id`**: **NULL** (ë§¤ìš° ì¤‘ìš”)
*   **`linked_transaction_id`**: Row 1ì˜ ID
*   **`amount`**: 10,000 (ì–‘ìˆ˜)
*   **UI í‘œí˜„**: `to_asset_id`ê°€ ì—†ì§€ë§Œ `linked_transaction_id`ê°€ ìˆìœ¼ë¯€ë¡œ **UIì—ì„œ ìˆ¨ê¹€(Hidden)** ì²˜ë¦¬ë©ë‹ˆë‹¤.

## 3. ë©”ëª¨ë¦¬ ë§¤í•‘ (Frontend Memory Layout)
ì•±ì´ ì‹¤í–‰ë˜ë©´ DBì˜ ìŠ¤ë„¤ì´í¬ í‘œê¸°ë²•(snake_case)ì´ ì¹´ë©œ í‘œê¸°ë²•(camelCase)ìœ¼ë¡œ ë§¤í•‘ë˜ì–´ ë©”ëª¨ë¦¬ì— ë¡œë“œë©ë‹ˆë‹¤.

```typescript
interface Transaction {
    id: string;
    type: 'transfer';
    amount: number;      // 10000
    assetId: string;     // ë‚´ ê³„ì¢Œ
    toAssetId?: string;  // ìƒëŒ€ ê³„ì¢Œ (ì¶œê¸ˆ ì¸¡ì—ë§Œ ì¡´ì¬)
    linkedTransactionId?: string; // ì—°ê²° ê³ ë¦¬
    // ...
}
```

## 4. ë¡œì§ ìš”ì•½
1.  **ì‹ë³„**: `toAssetId` ê°’ì´ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ì—¬ ëˆ„ê°€ 'Source(Main)'ì¸ì§€ íŒë‹¨í•©ë‹ˆë‹¤.
2.  **ì°¸ì¡°**: `toAssetId`ë¥¼ ì´ìš©í•´ ë©”ëª¨ë¦¬ì— ìˆëŠ” `assets` ë°°ì—´ì—ì„œ ìƒëŒ€ë°© ì€í–‰ ì´ë¦„(Bank B)ì„ ì¦‰ì‹œ ì°¾ì•„ëƒ…ë‹ˆë‹¤.
3.  **ë Œë”ë§**: 
    - ìì‹ ì˜ ì •ë³´(`assetId` + `amount`) â **Red Line**
    - ìƒëŒ€ì˜ ì •ë³´(`toAssetId` + `amount`) â **Green Line**
    
ì´ êµ¬ì¡° ë•ë¶„ì— ë³„ë„ì˜ JOIN ì¿¼ë¦¬ ì—†ì´ ë‹¨ì¼ Row ë°ì´í„°ë§Œìœ¼ë¡œë„ ë‘ ì¤„ì˜ ì™„ë²½í•œ ì´ì²´ ì •ë³´ë¥¼ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
