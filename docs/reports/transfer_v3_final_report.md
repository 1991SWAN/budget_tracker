# Transfer V3 최종 로직 보고서

사용자 요청에 따라 이체 로직(V3)의 최종 구현 상태와, 특히 "두 개의 양수 내역"으로 보이는 현상이 **이체 연결(Link) 후**에 어떻게 변하는지 설명합니다.

---

## 1. 현재 상태 (가져오기 직후)
사용자 화면에 보이는 상태는 **"아직 연결되지 않은 데이터(Unlinked Data)"**입니다.

- **Bank A (출금)**: 10,000원 빠져나감
- **Bank B (입금)**: 10,000원 들어옴

현재는 시스템이 이 둘을 서로 다른 별개의 거래로 인식하고 있으므로 두 줄로 표시됩니다. 또한, 가져오기 모드(General/Banking)에 따라 둘 다 양수(Positive)로 표시될 수 있습니다. (최근 패치로 출금은 빨간색으로 표시되도록 수정되었습니다.)

---

## 2. 연결(Link) 완료 후 예상 모습

상단의 **"Transfer Suggestions Found" (이체 제안 발견)** 배너를 통해 연결을 완료하면, 리스트는 다음과 같이 **하나의 카드**로 통합됩니다.

### 통합된 모습 (Merged View)
| 항목 | 표시 내용 | 비고 |
| :--- | :--- | :--- |
| **메인 텍스트** | **Transfer to Bank B** | 출금 측 메모 사용 |
| **금액** | **-10,000** (빨간색) | 출금(Withdrawal) 기준 표시 |
| **자산 정보** | **Bank A** | 출금 계좌 표시 |
| **카테고리** | **이체 (Transfer)** | |

### 내부 동작 원리
1. **출금 거래 (Source)**:
    - 화면에 **표시됩니다**.
    - 금액은 **마이너스(-)**로 표시됩니다.
    - 내부에 '받는 계좌(to_asset_id)' 정보가 저장됩니다.
2. **입금 거래 (Destination)**:
    - 화면에서 **숨겨집니다 (Hidden)**.
    - 잔액 계산에는 정상적으로 반영(+10,000)되지만, 리스트 중복을 막기 위해 숨깁니다.

---

## 3. 요약 결론
지금 보시는 **"두 개의 파란색 내역"**은 연결 전의 임시 상태입니다.
연결을 수행하면 **"하나의 빨간색 출금 내역"**으로 깔끔하게 정리되며, 잔액은 양쪽 계좌에 정확히 반영됩니다.

## 4. 버그 수정 및 재검증 안내 (Troubleshooting)

**방금 중요한 버그 하나를 수정했습니다:**
- **문제**: 이체 연결 시 데이터베이스 필드명(`to_asset_id`)과 프론트엔드 코드명(`toAssetId`)이 일치하지 않아, 연결 버튼을 눌러도 실제로는 정보가 저장되지 않고 두 줄로 남는 현상이 있었습니다.
- **조치**: 코드의 필드명을 일관성 있게 수정하여 이제 정상적으로 클릭 시 정보가 연동됩니다.

**다시 확인해 주세요:**
1. 브라우저를 **새로고침**합니다.
2. 가져오기(Import)를 다시 시도하거나, 상단의 배너가 있다면 **[Review] -> [Link]**를 다시 눌러주세요.
3. 이제 정상적으로 **한 줄로 통합**되고, 금액이 **빨간색 마이너스(-)**로 변하는 것을 확인하실 수 있습니다.
